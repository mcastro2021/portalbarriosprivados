{% extends "base.html" %}

{% block title %}Mapa del Barrio - Tejas Cuatro{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1">
                <i class="bi bi-map me-2"></i>Plano del Barrio - Tejas Cuatro
            </h2>
            <p class="text-muted mb-0">Plano de Lote Joven - Tejas Cuatro Barrio con Seguridad</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-primary" onclick="downloadImage()">
                <i class="bi bi-download me-2"></i>Descargar
            </button>
            <button class="btn btn-outline-info" onclick="toggleFullscreen()">
                <i class="bi bi-arrows-fullscreen me-2"></i>Pantalla Completa
            </button>
        </div>
    </div>

    <!-- Mapa Estático -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <i class="bi bi-geo-alt me-2"></i>Plano de Tejas Cuatro
                        </h6>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-secondary" onclick="zoomIn()">
                                <i class="bi bi-zoom-in"></i>
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="zoomOut()">
                                <i class="bi bi-zoom-out"></i>
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="resetZoom()">
                                <i class="bi bi-arrows-fullscreen"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="text-center p-3 bg-light">
                        <small class="text-muted">
                            <i class="bi bi-info-circle me-1"></i>
                            Plano oficial del desarrollo Lote Joven - Tejas Cuatro
                        </small>
                    </div>
                    
                    <div id="mapContainer" class="position-relative" style="height: 700px; overflow: auto; background: #f8f9fa;">
                        <img id="mapImage" 
                             src="{{ url_for('static', filename='images/tejas4-map.png') }}" 
                             alt="Plano de Tejas Cuatro"
                             style="width: 100%; height: auto; max-width: none; cursor: grab;"
                             onerror="showMapError()">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Información del Desarrollo -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h6 class="mb-0">
                        <i class="bi bi-info-circle me-2"></i>Información del Desarrollo
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6 mb-3">
                            <div class="h5 text-primary mb-0">70</div>
                            <small class="text-muted">Total Manzanas</small>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="h5 text-success mb-0">18</div>
                            <small class="text-muted">Etapa 1 (Vendida)</small>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="h5 text-warning mb-0">20</div>
                            <small class="text-muted">Etapa 2A (En Venta)</small>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="h5 text-info mb-0">7</div>
                            <small class="text-muted">Espacios Verdes</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h6 class="mb-0">
                        <i class="bi bi-list-ul me-2"></i>Etapas del Desarrollo
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-2">
                        <strong>Etapa 1:</strong> Manzanas 40-57 (Vendida)
                    </div>
                    <div class="mb-2">
                        <strong>Etapa 2A:</strong> Manzanas 20-39 (En Venta)
                    </div>
                    <div class="mb-2">
                        <strong>Etapa 2B:</strong> Manzanas 1-19 (Desarrollo)
                    </div>
                    <div class="mb-2">
                        <strong>Etapa 3:</strong> Manzanas 58-70 (Futuro)
                    </div>
                    <hr>
                    <div class="mb-2">
                        <strong>Espacios Verdes:</strong> E.V.1 a E.V.7
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Pantalla Completa -->
<div class="modal fade" id="fullscreenModal" tabindex="-1">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Plano de Tejas Cuatro - Vista Completa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0">
                <img id="fullscreenImage" 
                     src="{{ url_for('static', filename='images/tejas4-map.png') }}" 
                     alt="Plano de Tejas Cuatro"
                     style="width: 100%; height: 100%; object-fit: contain;">
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let currentZoom = 1;
const zoomStep = 0.2;
const minZoom = 0.5;
const maxZoom = 3;

function zoomIn() {
    if (currentZoom < maxZoom) {
        currentZoom += zoomStep;
        applyZoom();
    }
}

function zoomOut() {
    if (currentZoom > minZoom) {
        currentZoom -= zoomStep;
        applyZoom();
    }
}

function resetZoom() {
    currentZoom = 1;
    applyZoom();
}

function applyZoom() {
    const mapImage = document.getElementById('mapImage');
    mapImage.style.transform = `scale(${currentZoom})`;
    mapImage.style.transformOrigin = 'center center';
}

function toggleFullscreen() {
    const modal = new bootstrap.Modal(document.getElementById('fullscreenModal'));
    modal.show();
}

function downloadImage() {
    const link = document.createElement('a');
    link.href = "{{ url_for('static', filename='images/tejas4-map.png') }}";
    link.download = 'plano-tejas-cuatro.png';
    link.click();
}

function showMapError() {
    const container = document.getElementById('mapContainer');
    container.innerHTML = `
        <div class="d-flex align-items-center justify-content-center h-100">
            <div class="text-center">
                <i class="bi bi-image text-muted" style="font-size: 4rem;"></i>
                <h5 class="mt-3 text-muted">Imagen del Plano no Disponible</h5>
                <p class="text-muted">El archivo del plano no se encuentra en el servidor.</p>
                <small class="text-muted">
                    Por favor, sube la imagen del plano a: <code>static/images/tejas4-map.png</code>
                </small>
            </div>
        </div>
    `;
}

// Event listeners para zoom con rueda del mouse
document.getElementById('mapContainer').addEventListener('wheel', function(e) {
    e.preventDefault();
    if (e.deltaY < 0) {
        zoomIn();
    } else {
        zoomOut();
    }
});

// Event listeners para arrastrar la imagen
let isDragging = false;
let startX, startY, scrollLeft, scrollTop;

document.getElementById('mapImage').addEventListener('mousedown', function(e) {
    isDragging = true;
    startX = e.pageX - this.offsetLeft;
    startY = e.pageY - this.offsetTop;
    scrollLeft = this.parentElement.scrollLeft;
    scrollTop = this.parentElement.scrollTop;
    this.style.cursor = 'grabbing';
});

document.addEventListener('mousemove', function(e) {
    if (!isDragging) return;
    e.preventDefault();
    const x = e.pageX - startX;
    const y = e.pageY - startY;
    const container = document.getElementById('mapContainer');
    container.scrollLeft = scrollLeft - (x - startX);
    container.scrollTop = scrollTop - (y - startY);
});

document.addEventListener('mouseup', function() {
    isDragging = false;
    document.getElementById('mapImage').style.cursor = 'grab';
});
</script>
{% endblock %}
